<!-- Flash Messages Component -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
    <div class="flash-container">
        {% for category, message in messages %}
            <div class="flash-message {{ category }}" data-flash-message>
                <div class="flash-icon">
                    {% if category == 'success' %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    {% elif category == 'error' %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                    {% elif category == 'warning' %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    {% else %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    {% endif %}
                </div>
                <div class="flash-content">{{ message }}</div>
                <button class="flash-close" onclick="dismissFlash(this)" aria-label="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
        {% endfor %}
    </div>
{% endif %}
{% endwith %}

<style>
/* Flash Messages Container */
.flash-container {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  min-width: 350px;
  max-width: 600px;
  width: auto;
}

/* Individual Flash Message */
.flash-message {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  margin-bottom: 12px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
  animation: slideDown 0.4s ease-out;
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.flash-icon {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
}

.flash-content {
  flex: 1;
  line-height: 1.5;
}

.flash-close {
  flex-shrink: 0;
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  transition: all 0.2s ease;
  opacity: 0.7;
}

.flash-close:hover {
  opacity: 1;
  background: rgba(0, 0, 0, 0.1);
}

.flash-message.success {
  color: #0f5132;
  background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
  border-left: 4px solid #28a745;
}

.flash-message.success .flash-icon svg {
  stroke: #28a745;
}

.flash-message.error {
  color: #721c24;
  background: linear-gradient(135deg, #f8d7da 0%, #f5c2c7 100%);
  border-left: 4px solid #dc3545;
}

.flash-message.error .flash-icon svg {
  stroke: #dc3545;
}

.flash-message.warning {
  color: #856404;
  background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
  border-left: 4px solid #ffc107;
}

.flash-message.warning .flash-icon svg {
  stroke: #ffc107;
}

.flash-message.info {
  color: #055160;
  background: linear-gradient(135deg, #cff4fc 0%, #9eeaf9 100%);
  border-left: 4px solid #0dcaf0;
}

.flash-message.info .flash-icon svg {
  stroke: #0dcaf0;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-30px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes slideUp {
  from {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  to {
    opacity: 0;
    transform: translateY(-30px) scale(0.95);
  }
}

.flash-message::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: currentColor;
  opacity: 0.3;
  animation: progressBar 5s linear forwards;
}

@keyframes progressBar {
  from {
    width: 100%;
  }
  to {
    width: 0%;
  }
}
</style>

<script>
if (typeof dismissFlash === 'undefined') {
    function dismissFlash(button) {
        const flashMessage = button.closest('[data-flash-message]');
        fadeOutFlash(flashMessage);
    }

    function fadeOutFlash(element) {
        element.style.animation = 'slideUp 0.3s ease-out';
        setTimeout(() => {
            element.remove();
            const container = document.querySelector('.flash-container');
            if (container && !container.querySelector('[data-flash-message]')) {
                container.remove();
            }
        }, 300);
    }

    document.addEventListener('DOMContentLoaded', function() {
        const flashMessages = document.querySelectorAll('[data-flash-message]');
        flashMessages.forEach(function(message) {
            setTimeout(function() {
                fadeOutFlash(message);
            }, 5000);
        });
    });
}
</script>
